<div class="container mt-4">
    <div class="row">
        <% if @book.present? %>
            <div class="col-12 col-lg-8">
                <div class="d-flex justify-content-between align-items-start mb-3">
                    <h1 class="h3 mb-0"><%= @book.title %></h1>
                    <% if admin? %>
                        <%= button_to '削除',
                                    book_path(@book),
                                    method: :delete,
                                    class: "btn btn-danger btn-sm",
                                    data: { 
                                        "turbo-confirm": "本当に「#{h(@book.title)}」を削除しますか？この操作は取り消せません。" 
                                    } %>
                    <% end %>
                </div>
                <dl class="row">
                    <dt class="col-sm-3">ISBN</dt>
                    <dd class="col-sm-9"><%= @book.isbn %></dd>

                    <dt class="col-sm-3">出版社</dt>
                    <dd class="col-sm-9"><%= @book.publisher.presence || '-' %></dd>

                    <% if @book.authors.any? %>
                        <dt class="col-sm-3">著者</dt>
                        <dd class="col-sm-9">
                            <ul class="list-unstyled mb-0">
                                <% @book.authors.each do |author| %>
                                    <li><%= author.name %></li>
                                <% end %>
                            </ul>
                        </dd>
                    <% end %>

                    <dt class="col-sm-3">在庫</dt>
                    <dd class="col-sm-9"><%= @book.stock_count.to_i > 0 ? "#{@book.stock_count}冊" : '在庫なし' %></dd>
                </dl>

                <div class="mt-4 d-flex">
                    <%= link_to '戻る', books_path, class: "btn btn-secondary me-2" %>
                    <% if current_user %>

                        <% if current_user&.lendings&.unreturned&.exists?(book_id: @book.id) %>
                            <%= button_to '返却する',
                                        lending_path(current_user.lendings.unreturned.find_by(book_id: @book.id)),
                                        method: :delete,
                                        class: "btn btn-danger" %>
                        <% elsif @book.stock_count.to_i > 0 %>
                            <%= button_to '借りる',
                                        lendings_path(book_id: @book.id),
                                        method: :post,
                                        class: "btn btn-primary" %>
                        <% end %>
                    <% end %>
                </div>
            </div>
        <% else %>
            <div class="col-12">
                <div class="alert alert-info">No book found.</div>
            </div>
        <% end %>
    </div>
</div>