<div class="container mt-4" data-controller="new-book-form">
    <div class="row">
        <div class="col-md-8 offset-md-2">
            <!-- ISBN検索フォーム（フレーム外） -->
            <div class="card mb-4">
                <div class="card-header bg-primary text-white">
                    <h3 class="mb-0">
                        <i class="bi bi-search me-2"></i>ISBN検索で書籍登録
                    </h3>
                </div>
                <div class="card-body">
                    <div class="alert alert-info">
                        <i class="bi bi-info-circle me-2"></i>
                        ISBNを入力して書籍情報を自動取得できます
                    </div>
                    <%= form_with url: search_isbn_books_path, method: :get, local: false do |form| %>
                        <div class="row">
                            <div class="col-9">
                                <%= form.label :isbn, "ISBN", class: "form-label" %>
                                <%= form.text_field :isbn, class: "form-control", placeholder: "9784103090501", required: true %>
                            </div>
                            <div class="col-3 d-flex align-items-end">
                                <%= form.submit "検索", class: "btn btn-primary w-100" %>
                            </div>
                        </div>
                    <% end %>

                    <!-- 手動入力切り替えボタン -->
                    <div class="text-center mt-4">
                        <button type="button" class="btn btn-outline-secondary" data-action="click->new-book-form#toggleToManual">
                            <i class="bi bi-pencil me-2"></i>手動入力はこちらから
                        </button>
                    </div>
                </div>
            </div>

            <!-- 検索結果表示エリア（Turbo Frame） -->
            <%= turbo_frame_tag "search_result" do %>
                <div class="card">
                    <div class="card-body text-center text-muted">
                        <i class="bi bi-book me-2"></i>
                        ISBNを入力して検索してください
                    </div>
                </div>
            <% end %>

            <!-- 手動入力フォーム（初期は非表示） -->
            <div class="card" data-new-book-form-target="manualForm" style="display: none;">
                <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
                    <h3 class="mb-0">手動で書籍登録</h3>
                    <button type="button" class="btn btn-sm btn-outline-light" data-action="click->new-book-form#backToSearch">
                        <i class="bi bi-arrow-left me-1"></i>ISBN検索に戻る
                    </button>
                </div>
                <div class="card-body">
                    <%= form_with(model: @book, local: true) do |form| %>
                        <% if @book.errors.any? %>
                            <div class="alert alert-danger">
                                <h4><%= pluralize(@book.errors.count, "error") %> prohibited this book from being saved:</h4>
                                <ul>
                                    <% @book.errors.full_messages.each do |message| %>
                                        <li><%= message %></li>
                                    <% end %>
                                </ul>
                            </div>
                        <% end %>

                        <div class="mb-3">
                            <%= form.label :isbn, "ISBN", class: "form-label" %>
                            <%= form.text_field :isbn, class: "form-control", required: true %>
                        </div>

                        <div class="mb-3">
                            <%= form.label :title, "タイトル", class: "form-label" %>
                            <%= form.text_field :title, class: "form-control", required: true %>
                        </div>

                        <div class="mb-3">
                            <%= form.label :author_names, "著者名（カンマ区切り）" %>
                            <%= text_field_tag :author_names, params[:author_names], class: "form-control", placeholder: "例: 夏目漱石, 太宰治" %>
                        </div>

                        <div class="mb-3">
                            <%= form.label :publisher, "出版社", class: "form-label" %>
                            <%= form.text_field :publisher, class: "form-control" %>
                        </div>

                        <div class="mb-3">
                            <%= form.label :published_year, "出版年", class: "form-label" %>
                            <%= form.date_field :published_year, class: "form-control" %>
                        </div>

                        <div class="mb-3">
                            <%= form.label :tag_names, "タグ名（カンマ区切り）" %>
                            <%= text_field_tag :tag_names, params[:tag_names], class: "form-control", placeholder: "例: 小説, 文学" %>
                        </div>

                        <div class="mb-3">
                            <%= form.label :stock_count, "在庫数", class: "form-label" %>
                            <%= form.number_field :stock_count, class: "form-control", min: 0, value: 1 %>
                        </div>

                        <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                            <%= form.submit "登録", class: "btn btn-primary" %>
                        </div>
                    <% end %>
                </div>
            </div>
        </div>
    </div>
</div>